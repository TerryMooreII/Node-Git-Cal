var https = require('https');
var async = require('async');

var repos = [];

var commits = [];
var emailAddress = 'terry.moore.ii@gmail.com';

// var commits = [ '2013-04-17T01:05:15Z',
//   '2013-04-17T01:02:02Z',
//   '2011-09-22T02:14:40Z',
//   '2011-08-10T00:48:13Z',
//   '2011-08-10T00:42:56Z',
//   '2011-07-17T18:12:35Z',
//   '2013-04-17T00:57:43Z',
//   '2013-04-17T00:48:03Z',
//   '2013-03-13T01:48:00Z',
//   '2013-03-13T01:44:14Z',
//   '2013-03-13T01:42:47Z',
//   '2013-09-24T00:35:13Z',
//   '2013-09-24T00:25:23Z',
//   '2013-09-22T23:35:17Z',
//   '2013-09-22T23:33:18Z',
//   '2013-09-22T23:30:43Z',
//   '2013-09-22T23:23:47Z',
//   '2013-09-22T23:02:28Z',
//   '2013-09-21T02:44:36Z',
//   '2013-09-21T02:44:22Z',
//   '2013-09-21T02:42:27Z',
//   '2013-09-21T02:41:14Z',
//   '2013-09-21T00:03:55Z',
//   '2013-09-21T00:01:39Z',
//   '2013-09-12T00:20:28Z',
//   '2013-09-12T00:11:14Z',
//   '2013-09-11T02:24:41Z',
//   '2013-09-11T02:10:09Z',
//   '2013-09-11T01:58:21Z',
//   '2013-09-09T00:12:37Z',
//   '2013-09-07T18:49:35Z',
//   '2013-09-07T18:39:25Z',
//   '2013-09-07T18:31:48Z',
//   '2013-09-07T00:12:58Z',
//   '2013-09-06T23:35:47Z',
//   '2013-09-05T02:19:27Z',
//   '2013-09-05T02:17:13Z',
//   '2013-09-05T02:07:17Z',
//   '2013-09-05T01:54:43Z',
//   '2013-09-05T00:23:40Z',
//   '2013-08-31T01:41:11Z',
//   '2013-08-31T01:38:10Z',
//   '2013-08-31T01:37:41Z',
//   '2013-08-31T01:36:12Z',
//   '2013-08-31T01:31:40Z',
//   '2013-08-31T01:26:47Z',
//   '2013-08-31T00:30:04Z',
//   '2013-07-30T13:03:48Z',
//   '2013-07-30T12:56:47Z',
//   '2013-07-30T12:01:58Z',
//   '2013-07-30T01:15:27Z',
//   '2013-07-29T19:47:27Z',
//   '2013-07-29T18:17:57Z',
//   '2013-07-29T17:23:37Z',
//   '2013-07-26T16:52:44Z',
//   '2013-07-26T16:52:12Z',
//   '2013-07-17T02:27:36Z',
//   '2013-07-17T02:05:15Z',
//   '2013-07-17T01:50:08Z',
//   '2013-07-17T01:47:24Z',
//   '2013-07-17T01:44:02Z',
//   '2013-07-17T01:33:14Z',
//   '2013-07-17T01:31:24Z',
//   '2013-09-18T02:50:55Z',
//   '2013-09-18T02:24:58Z',
//   '2013-09-18T02:12:18Z',
//   '2013-09-13T00:29:15Z',
//   '2013-09-13T00:28:20Z',
//   '2013-09-13T00:27:19Z',
//   '2013-09-13T00:26:08Z',
//   '2013-03-19T01:05:08Z',
//   '2013-03-19T00:58:53Z',
//   '2013-03-16T03:10:43Z',
//   '2013-03-13T01:35:09Z',
//   '2013-03-13T01:18:54Z',
//   '2013-02-20T17:43:57Z',
//   '2013-02-20T02:12:15Z',
//   '2013-02-19T03:43:56Z',
//   '2013-02-17T04:26:53Z',
//   '2013-02-17T04:20:54Z',
//   '2013-02-17T03:36:49Z',
//   '2013-02-17T03:27:06Z',
//   '2013-02-14T03:01:15Z',
//   '2013-02-13T03:13:18Z',
//   '2013-02-12T04:02:00Z',
//   '2013-02-12T01:54:19Z',
//   '2013-02-11T03:45:52Z',
//   '2013-02-07T03:52:48Z',
//   '2013-02-06T04:16:15Z',
//   '2013-02-06T02:10:11Z',
//   '2013-02-06T02:09:03Z',
//   '2013-02-06T01:59:51Z',
//   '2013-02-05T19:44:54Z',
//   '2011-03-18T01:23:48Z',
//   '2013-07-12T01:01:00Z',
//   '2013-07-10T02:26:45Z',
//   '2013-07-07T04:14:56Z',
//   '2013-07-06T03:49:30Z',
//   '2013-07-06T03:48:37Z',
//   '2013-07-04T03:59:32Z',
//   '2013-07-04T03:46:38Z',
//   '2013-07-04T03:45:39Z',
//   '2013-06-28T03:16:43Z',
//   '2013-06-24T02:59:37Z',
//   '2013-06-24T02:56:53Z',
//   '2013-06-24T00:57:31Z',
//   '2013-06-21T03:22:05Z',
//   '2013-06-19T03:06:22Z',
//   '2013-06-18T02:55:40Z',
//   '2013-06-16T17:23:20Z',
//   '2013-06-13T01:17:40Z',
//   '2013-06-13T01:15:07Z',
//   '2013-06-13T01:13:38Z',
//   '2013-02-14T19:54:12Z',
//   '2013-02-13T15:15:45Z',
//   '2013-02-13T15:12:20Z',
//   '2013-01-30T09:44:25Z',
//   '2013-01-30T09:43:57Z',
//   '2013-01-30T09:43:00Z',
//   '2013-01-30T09:25:22Z',
//   '2013-01-29T15:15:30Z',
//   '2013-01-29T14:43:39Z',
//   '2013-01-29T14:22:53Z',
//   '2013-01-27T14:21:35Z',
//   '2013-01-27T13:54:43Z',
//   '2013-01-27T13:48:24Z',
//   '2013-01-26T19:30:09Z',
//   '2013-01-26T18:55:42Z',
//   '2013-01-26T15:45:13Z',
//   '2013-01-26T15:01:18Z',
//   '2013-01-26T15:00:41Z',
//   '2013-01-26T13:34:58Z',
//   '2013-01-26T07:32:46Z',
//   '2013-01-25T21:26:44Z',
//   '2013-01-25T21:19:10Z',
//   '2013-01-25T21:18:30Z',
//   '2013-01-25T18:30:17Z',
//   '2013-01-25T17:58:42Z',
//   '2013-01-25T09:15:31Z',
//   '2013-01-25T09:13:37Z',
//   '2013-01-25T07:40:30Z',
//   '2013-01-25T07:32:18Z',
//   '2013-01-25T06:42:57Z',
//   '2012-10-08T21:40:29Z',
//   '2012-08-19T17:25:51Z',
//   '2012-07-19T15:31:29Z',
//   '2012-07-19T15:30:33Z',
//   '2012-06-21T23:34:13Z',
//   '2012-06-01T21:25:21Z',
//   '2012-03-22T22:37:57Z',
//   '2012-03-13T07:38:23Z',
//   '2011-10-20T18:52:56Z',
//   '2011-08-30T16:18:38Z',
//   '2011-08-24T16:42:47Z',
//   '2011-03-06T01:29:18Z',
//   '2011-02-23T21:54:25Z',
//   '2011-01-20T18:47:02Z',
//   '2010-12-08T09:24:13Z',
//   '2010-11-18T18:45:22Z',
//   '2013-07-16T12:32:40Z',
//   '2013-07-16T12:26:10Z',
//   '2013-07-15T19:25:08Z',
//   '2013-07-15T19:16:27Z',
//   '2013-07-15T19:11:17Z',
//   '2013-07-15T19:09:50Z',
//   '2013-07-15T19:05:47Z',
//   '2013-07-15T19:04:40Z',
//   '2013-07-15T18:48:15Z',
//   '2013-07-15T18:10:54Z',
//   '2013-07-15T18:04:45Z',
//   '2013-07-15T15:36:07Z',
//   '2013-07-15T15:27:02Z',
//   '2013-07-15T15:26:15Z',
//   '2013-07-15T15:14:14Z',
//   '2013-07-15T15:13:28Z',
//   '2013-07-15T15:13:03Z',
//   '2013-07-15T15:10:00Z',
//   '2013-07-15T14:56:41Z',
//   '2013-07-15T14:54:42Z',
//   '2013-07-15T14:52:03Z',
//   '2013-07-15T14:50:51Z',
//   '2013-07-15T14:44:21Z',
//   '2013-07-15T14:43:47Z',
//   '2013-07-11T20:09:17Z',
//   '2013-07-11T14:01:48Z',
//   '2013-07-10T19:57:41Z',
//   '2013-07-10T19:46:10Z',
//   '2013-07-10T19:39:46Z',
//   '2013-07-10T19:34:10Z',
//   '2013-02-02T01:29:25Z',
//   '2012-12-07T14:27:23Z',
//   '2012-12-07T12:27:29Z',
//   '2012-10-30T15:53:55Z',
//   '2012-10-30T15:50:25Z',
//   '2012-10-28T14:27:27Z',
//   '2012-10-27T15:35:02Z',
//   '2012-10-27T15:30:45Z',
//   '2012-10-23T19:18:57Z',
//   '2012-10-23T19:18:44Z',
//   '2012-10-23T19:09:06Z',
//   '2012-10-23T18:04:20Z',
//   '2012-10-23T17:37:00Z',
//   '2012-10-23T17:25:29Z',
//   '2012-10-23T17:25:17Z',
//   '2012-10-23T17:10:53Z',
//   '2012-09-29T13:35:40Z',
//   '2012-09-29T13:31:14Z',
//   '2012-09-29T13:31:05Z',
//   '2012-09-29T13:30:42Z',
//   '2012-09-29T13:10:31Z',
//   '2012-09-07T09:42:39Z',
//   '2012-08-19T15:18:25Z',
//   '2012-08-19T15:18:20Z',
//   '2012-08-19T15:15:44Z',
//   '2012-08-19T15:04:25Z',
//   '2012-08-19T15:02:57Z',
//   '2012-08-19T14:53:18Z',
//   '2012-08-19T14:30:16Z',
//   '2012-08-19T14:30:06Z',
//   '2013-01-26T02:57:50Z',
//   '2012-11-26T00:48:57Z',
//   '2012-11-26T00:46:56Z',
//   '2012-11-26T00:23:45Z',
//   '2012-11-25T23:42:08Z',
//   '2012-11-25T23:31:30Z',
//   '2012-11-25T23:22:05Z',
//   '2012-11-12T16:13:01Z',
//   '2012-11-11T21:16:38Z',
//   '2012-10-31T04:40:11Z',
//   '2012-10-31T04:31:02Z',
//   '2012-10-31T04:28:28Z',
//   '2012-10-31T04:12:15Z',
//   '2012-10-31T04:07:51Z',
//   '2012-10-11T22:23:19Z',
//   '2012-10-11T22:10:08Z',
//   '2012-10-09T21:50:17Z',
//   '2012-10-03T00:48:09Z',
//   '2012-10-02T09:42:43Z',
//   '2012-10-02T09:40:14Z',
//   '2012-09-25T14:11:40Z',
//   '2012-09-24T15:06:38Z',
//   '2012-09-24T15:05:13Z',
//   '2012-09-24T14:49:59Z',
//   '2012-09-13T01:45:40Z',
//   '2012-09-13T01:44:56Z',
//   '2012-09-12T22:57:09Z',
//   '2012-09-12T12:59:17Z',
//   '2012-09-06T10:21:57Z',
//   '2012-09-05T16:57:30Z',
//   '2011-03-18T01:02:09Z',
//   '2011-03-18T00:53:20Z',
//   '2011-03-18T00:29:35Z',
//   '2011-03-18T01:15:50Z',
//   '2011-03-18T01:13:35Z',
//   '2013-03-18T13:25:14Z',
//   '2013-02-13T03:39:31Z',
//   '2012-10-06T19:35:13Z',
//   '2012-10-06T18:41:25Z',
//   '2012-10-05T21:08:33Z',
//   '2012-10-05T21:07:22Z',
//   '2012-10-05T20:54:57Z',
//   '2012-10-05T20:53:48Z',
//   '2012-10-05T20:40:32Z',
//   '2012-10-05T18:26:52Z',
//   '2013-05-14T20:57:44Z',
//   '2013-01-25T01:15:06Z',
//   '2013-01-25T01:03:35Z',
//   '2013-01-25T01:00:06Z',
//   '2011-03-16T01:04:57Z',
//   '2011-03-16T00:55:52Z',
//   '2011-03-16T00:42:36Z',
//   '2012-09-23T00:18:55Z',
//   '2012-09-22T19:18:23Z',
//   '2012-09-22T18:37:47Z',
//   '2012-09-22T17:17:28Z',
//   '2012-09-22T17:15:17Z',
//   '2012-09-22T17:07:27Z',
//   '2012-09-22T16:51:12Z' ];

// var now = new Date(Date.now());
// var daysOfYear = [];

// for (var d = new Date(now.getFullYear() - 1, now.getMonth(), now.getDate() ); d <= now; d.setDate(d.getDate() + 1)) {
//     daysOfYear.push(new Date(d));
// }


// console.log(daysOfYear)


// commits = commits.sort();


// var c = [];
// var cd;
// var count =0;

// for (var i=0; i< commits.length; i++){

  
//   if (cd === commits[i].split('T')[0]){
//     count++
//   }
//   else{
//     count = 1;
//   }
  
//   cd = commits[i].split('T')[0];

//   c[cd] = count;

// }

// console.log(c)

https://api.github.com/repos/TerryMooreII/CanvasClock/commits
var options = {
   host: 'api.github.com',
   port: 443,
   path: '/user/repos',//'/repos/TerryMooreII/CanvasClock/commits',
   // authentication headers
   headers: {
      'Authorization': 'Basic ' + new Buffer("terrymooreii" + ':' + "m0t3rsh0").toString('base64')
   }   
};

//this is the call
request = https.get(options, function(res){
   var body = "";
   
   res.on('data', function(data) {
      body += data;
   });
   
   res.on('end', function() {
    
      var json = JSON.parse(body);   
    
      json.forEach(function(obj){
        repos.push(obj.name);
      });

      
      async.each(repos, getCommits, function(err){
        console.log(err);
        console.log(commits.sort());
        console.log(commits.length);
      })      
      //repos.forEach( function(repo){getCommits(repo)} );

   });

   res.on('error', function(e) {
      console.log("Got error: " + e.message);
   });
  
});



function getCommits(repo, callback){
  var options = {
   host: 'api.github.com',
   port: 443,
   path: '/repos/TerryMooreII/'+ repo +'/commits',
   // authentication headers
   headers: {
      'Authorization': 'Basic ' + new Buffer("terrymooreii" + ':' + "m0t3rsh0").toString('base64')
   }   
};

//this is the call
request = https.get(options, function(res){
   var body = "";
   
   res.on('data', function(data) {
      body += data;
   });
   
   res.on('end', function() {
    
      var json = JSON.parse(body);   
    
      json.forEach(function(obj){
        if (obj.commit.committer &&  obj.commit.committer.email.toLowerCase() === emailAddress)
          commits.push(new Date(obj.commit.committer.date));
      });

      callback();

   });

   res.on('error', function(e) {
      console.log("Got error: " + e.message);
   });
  
});

}


//'2013-09-24T00:35:13Z'
function convertDate(date){
//return date;
  var y = date.substr(0, 4);
  var m = date.substr(5,2);
  var d = date.substr(8,2);
  var h = date.substr(11,2);
  var min = date.substr(14, 2);
  var s = date.substr(17, 2);
  
  var da = new Date(y, m, d, h, min, s);
  
  console.log("Date: %s :: %d %d %d %d %d %d :: %s", date, y, m, d, h, min, s, da)
  
  return da;

}
















